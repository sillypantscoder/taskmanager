<!DOCTYPE html>
<html>
	<head>
		<title>Task Manager</title>
		<style>
.tasks div {
	background-color: #9AF;
	border-left: 0.3em solid blue;
	margin: 0.8em;
	padding: 0.8em;
}
.tasks div.before {
	background-color: #F99;
	border-left-color: red;
}
#completedtasks div {
	background-color: #9F9;
	border-left-color: green;
}
a {
	color: rgb(0, 0, 238);
}
		</style>
	</head>
	<body>
		<h1>Task Manager</h1>
		<p><a href="/new">New task</a>
		<div id="tasks" class="tasks"></div>
		<h3>Completed tasks</h3>
		<div id="completedtasks" class="tasks"></div>
		<script src="https://momentjs.com/downloads/moment.min.js"></script>
		<script>
async function getURL(url) {
	r = await new Promise((resolve) => {
		var x = new XMLHttpRequest();
		x.open("GET", url);
		x.addEventListener("loadend", () => {
			resolve(x.responseText);
		})
		x.send();
	})
	return r;
}
getURL("/tasks.json").then((v) => {
	tasks = JSON.parse(v);
	for (var i = 0; i < tasks.length; i++) {
		var task = tasks[i];
		var div = document.createElement("div");
		var date = new Date(task.date)
		if (task.date == "") date = new Date();
		if (task.repeat == 1) {
			if (date < new Date()) {
				div.classList.add("before")
				div.innerHTML = "<b>" + task.name + "</b> needed to be done " + moment(date.toISOString()).fromNow();
			} else {
				div.innerHTML = "<b>" + task.name + "</b> needs to be done " + moment(date.toISOString()).fromNow();
			}
			div.innerHTML += `<br><button onclick='getURL("/complete/${i}").then(() => location.reload())'>Completed</button> <a href="/edit/${i}">Edit task</a>`
			document.getElementById("tasks").appendChild(div);
		} else if (task.repeat == 0) {
			div.innerHTML = "<b>" + task.name + "</b> was done " + moment(date.toISOString()).fromNow();
			div.innerHTML += `<br><button onclick='getURL("/restore/${i}").then(() => location.reload())'>Restore</button> <a href="/edit/${i}">Edit task</a>`
			document.getElementById("completedtasks").appendChild(div);
		}
	}
})
		</script>
	</body>
</html>
